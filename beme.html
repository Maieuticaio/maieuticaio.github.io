<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Портфолио — один HTML</title>
  <style>
    :root {
      /* Глобальные переменные */
      --page-xpad: 50px;
      --nav-item-h: 44px;
      --gap-vert: 50px;
      --border-w: 2px;
      --overlay-dim: rgba(0,0,0,.72);
      --nav-fs: 1rem;      /* базовый размер шрифта навигации и описаний */
      --nav-gap: 8px;      /* расстояние между пунктами и отступ сверху */
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Noto Sans', Arial, 'Apple Color Emoji','Segoe UI Emoji';
      color: #000;
      background: #fff;
      line-height: 1.4;
    }

    /* =================== NAV =================== */
    .nav {
      position: fixed;
      top: var(--nav-gap);
      right: 0;
      z-index: 40;
      display: flex;
      flex-direction: column;
      gap: var(--nav-gap);
      pointer-events: auto;
      font-size: var(--nav-fs);
    }
    .nav__item {
      position: relative;
      background: #000;
      color: #fff;
      height: var(--nav-item-h);
      border: none;
      margin: 0;
      padding: 0 15px;
      width: fit-content;
      align-self: flex-end;
      transition: width .25s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      overflow: hidden;
      border-radius: 0;
      clip-path: polygon(
        var(--x1,0%)  var(--y1,2%),
        var(--x2,100%) var(--y2,1%),
        var(--x3,100%) var(--y3,98%),
        var(--x4,0%)   var(--y4,99%)
      );
      outline: var(--border-w) solid #000;
      outline-offset: 0;
    }
    .nav__item .label { transition: opacity .18s ease; text-transform: uppercase; }
    .nav__item.collapsed { width: 10px; max-width: 10px; min-width: 0; padding: 0; }
    .nav__item.collapsed .label { opacity: 0; }
    .nav__item.active { outline-color: #111; }

    /* =================== PAGE WRAPPER =================== */
    main {
      min-height: 100vh;
      padding: 0 var(--page-xpad) 80px; /* убрали верхний паддинг у main, чтобы общий верхний отступ контролировали страницы */
    }
    /* На главной странице отступов не должно быть */
    body.is-home main { padding: 0; }

    section.page { display: none; }
    section.page.active { display: block; }

    /* Заголовки секций */
    .page h1 { font-size: 28px; margin: 0 0 20px; font-weight: 700; text-align: left; }

    /* Отступ сверху на всех страницах (кроме главной) */
    section.page { padding-top: 50px; }
    #home { padding-top: 0; }
    /* Специальный правый отступ только для страницы "Обо мне": 50px (главный) + 15px (секция) = 65px */
    #about { padding-right: 15px; }

    /* =================== HOME =================== */
    #home {
      position: relative;
      min-height: 100vh; /* во всю высоту экрана для пересечения анимаций */
      overflow: hidden; /* чтобы анимации "вплывали" */
    }
    .shapes-layer { position: absolute; inset: 0; pointer-events: none; }
    .shape, .wave { position: absolute; opacity: .9; }
    .shape.square{ background:#000; }
    .shape.circle{ background:#000; border-radius:50%; }
    .wave {
      /* волнистая лента с параметризуемыми сегментами */
      width:220px; height:20px;
      background: repeating-linear-gradient(90deg, #000 0 calc(var(--segW,24px)/2), transparent calc(var(--segW,24px)/2) var(--segW,24px));
      -webkit-mask: radial-gradient(calc(var(--segW,24px)/2) calc(var(--segH,20px)/2) at calc(var(--segW,24px)/2) calc(var(--segH,20px)/2), #000 98%, transparent) repeat-x left center / var(--segW,24px) var(--segH,20px);
              mask: radial-gradient(calc(var(--segW,24px)/2) calc(var(--segH,20px)/2) at calc(var(--segW,24px)/2) calc(var(--segH,20px)/2), #000 98%, transparent) repeat-x left center / var(--segW,24px) var(--segH,20px);
      background-clip: padding-box;
    }

    @keyframes floatLR { from{ transform: translateX(-120vw);} to{ transform: translateX(120vw);} }
    @keyframes floatRL { from{ transform: translateX(120vw);} to{ transform: translateX(-120vw);} }
    @keyframes floatTB { from{ transform: translateY(-120vh);} to{ transform: translateY(120vh);} }
    @keyframes floatBT { from{ transform: translateY(120vh);} to{ transform: translateY(-120vh);} }

    /* =================== ABOUT =================== */
    .about {
      display: flex;
      gap: 24px;
      align-items: flex-start;
      justify-content: flex-end; /* выравнивание по правому краю всей полосы */
    }
    .about__image {
      flex: 0 0 33.333vw; /* занимает треть экрана по ширине */
      max-width: 33.333vw;
    }
    .about__image img {
      display: block;
      width: 100%;     /* фиксированная по ширине доля */
      height: auto;    /* любая высота */
      object-fit: cover;
    }
    .about__text { flex: 1 1 auto; min-width: 280px; font-size: 0.8rem; }
    /* Убираем верхний внешний отступ у первого элемента текста, чтобы картинка и текст были ровно по верхнему краю */
    .about__text > :first-child { margin-top: 0; }

    /* Кнопка назад/домой (нижний правый угол) */
    .home-back{
      position: fixed;
      right: 0;
      bottom: var(--nav-gap);
      z-index: 45;
      height: var(--nav-item-h);
      background:#000; color:#fff;
      border:none; border-radius:0; cursor:pointer;
      padding: 0 15px;
      display: flex;
      align-items:center; justify-content:center;
      font: inherit;
      clip-path: polygon(
        var(--x1,0%)  var(--y1,2%),
        var(--x2,100%) var(--y2,1%),
        var(--x3,100%) var(--y3,98%),
        var(--x4,0%)   var(--y4,99%)
      );
      outline: var(--border-w) solid #000;
      outline-offset: 0;
    }
    /* Иконка на кнопке: на главной ":>", на внутренних ">" */
    .home-back::before{ content: '>'; color:#fff; display:inline-block; line-height:1; }
    body.is-home .home-back::before{ content: ':>'; }

    /* =================== FEED PAGES (Картинки, Штуки, Ed‑tech) =================== */
    .feed {
      display: flex;
      flex-direction: column;
      align-items: flex-start; /* все блоки по левому краю */
      gap: var(--gap-vert);
    }
    .block { width: 100%; max-width: 1200px; }
    .block__title { font-weight: 800; margin: 0 0 12px; text-align: left; }

    .gallery {
      display: flex;
      gap: 12px;
      overflow-x: auto;        /* горизонтальная прокрутка */
      padding-bottom: 8px;
      scrollbar-width: thin;
    }
    .gallery::-webkit-scrollbar { height: 10px; }
    .gallery::-webkit-scrollbar-thumb { background: rgba(0,0,0,.3); }
    .gallery::-webkit-scrollbar-track { background: rgba(0,0,0,.08); }

    .media {
      height: 200px;           /* фиксированная высота превью */
      flex: 0 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ddd;         /* серые превью-фреймы */
      color: #666;
      border: 1px solid #ccc;
      border-radius: 0;         /* без скруглений */
      cursor: pointer;
      position: relative;
      aspect-ratio: auto;       /* ширина берётся из inline-style width */
    }
    .media img, .media video, .media svg {
      height: 100%;
      width: auto;              /* подгон по ширине формата */
      display: block;
      pointer-events: none;
    }
    .block__desc { max-width: 60ch; margin-top: 10px; margin-left: 0; text-align: left; font-size: 0.8rem; }

    /* =================== LIGHTBOX =================== */
    .lightbox { position: fixed; inset: 0; background: var(--overlay-dim); display: none; place-items: center; z-index: 100; }
    .lightbox.open { display: grid; }
    .lightbox__inner {
      position: relative;
      max-width: calc(100vw - 200px);  /* 100px отступы по узкой стороне */
      max-height: calc(100vh - 200px);
      display: inline-block;
    }
    .lightbox__media { display: block; max-width: 100%; max-height: 100%; border-radius: 0; background:#ddd; }
    .lb-btn {
      position: absolute;
      top: 50%; transform: translateY(-50%);
      width: 44px; height: 44px; border-radius: 50%; border: none; cursor: pointer;
      background: #000; color: #fff; display: grid; place-items: center; font-size: 20px; line-height: 1;
    }
    .lb-prev { left: -60px; }
    .lb-next { right: -60px; }
    .lb-close { position:absolute; top:-60px; right:0; width:40px; height:40px; background:transparent; color:#000; border:none; cursor:pointer; border-radius:0; display:flex; align-items:center; justify-content:center; font-size:32px; line-height:1; }

    /* Адаптив: если очень узко, немного поджимаем стрелки */
    @media (max-width: 640px) {
      .lb-prev { left: -44px; }
      .lb-next { right: -44px; }
      .lb-close { top: -50px; }
    }

    /* Учет доступности: меньше анимаций, если пользователь просит */
    @media (prefers-reduced-motion: reduce) {
      .shape, .wave { animation: none !important; }
    }

    /* =================== FIREWORK (домашняя кнопка) =================== */
    .spark{ position:fixed; width:10px; height:10px; background:#000; pointer-events:none; will-change:transform,opacity; z-index:60; opacity:1; }
    .spark.circle{ border-radius:50%; }
    .spark.semi{ border-radius:50% 50% 0 0 / 50% 50% 0 0; overflow:hidden; }
  </style>
</head>
<body>
  <!-- =================== NAV =================== -->
  <nav class="nav" id="nav">
    <button class="nav__item" data-target="pictures"><span class="label">Картинки</span></button>
    <button class="nav__item" data-target="things"><span class="label">Штуки</span></button>
    <button class="nav__item" data-target="edtech"><span class="label">Ed‑tech</span></button>
    <button class="nav__item" data-target="about"><span class="label">Обо мне</span></button>
  </nav>
  
  <!-- Кнопка в правом нижнем углу -->
  <button class="home-back" id="homeBack" aria-label=":>" title=":>"></button>

  <main>
    <!-- =================== HOME =================== -->
    <section class="page active" id="home">
      <div class="shapes-layer" id="shapes"></div>
    </section>

    <!-- =================== PICTURES =================== -->
    <section class="page" id="pictures">
      <div class="feed">
        <article class="block">
          <h2 class="block__title">Серия A</h2>
          <div class="gallery" data-gallery>
            <div class="media" style="width: 260px" title="Фрейм 1"></div>
            <div class="media" style="width: 180px" title="Фрейм 2"></div>
            <div class="media" style="width: 320px" title="Фрейм 3"></div>
            <div class="media" style="width: 210px" title="Фрейм 4"></div>
            <div class="media" style="width: 280px" title="Фрейм 5"></div>
          </div>
          <div class="block__desc">Описание серии A. Серые фреймы разной ширины — заглушки под изображения/видео/GIF/SVG.</div>
        </article>

        <article class="block">
          <h2 class="block__title">Серия B</h2>
          <div class="gallery" data-gallery>
            <div class="media" style="width: 200px"></div>
            <div class="media" style="width: 340px"></div>
            <div class="media" style="width: 190px"></div>
            <div class="media" style="width: 270px"></div>
          </div>
          <div class="block__desc">Описание серии B. Колесо мыши или палец прокручивают ленту горизонтально.</div>
        </article>
      </div>
    </section>

    <!-- =================== THINGS =================== -->
    <section class="page" id="things">
      <div class="feed">
        <article class="block">
          <h2 class="block__title">Проект X</h2>
          <div class="gallery" data-gallery>
            <div class="media"><img src="https://maieuticaio.github.io/folder/camphoto_341603450.jpeg" alt="Изображение проекта" loading="lazy" /></div>
            <div class="media" style="width: 240px"></div>
            <div class="media" style="width: 180px"></div>
            <div class="media" style="width: 300px"></div>
          </div>
          <div class="block__desc">Короткое описание проекта X.</div>
        </article>
      </div>
    </section>

    <!-- =================== EDTECH =================== -->
    <section class="page" id="edtech">
      <div class="feed">
        <article class="block">
          <h2 class="block__title">Интерактивы</h2>
          <div class="gallery" data-gallery>
            <div class="media" style="width: 300px"></div>
            <div class="media" style="width: 200px"></div>
            <div class="media" style="width: 260px"></div>
          </div>
          <div class="block__desc">Описание образовательных интерактивов.</div>
        </article>
      </div>
    </section>

    <!-- =================== ABOUT =================== -->
    <section class="page" id="about">
      <div class="about">
        <div class="about__image">
          <!-- Заглушка-изображение SVG вшито в data URI (замените на свою картинку при желании) -->
          <img alt="Фото" src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='1200'><rect width='100%' height='100%' fill='%23e5e5e5'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='48' fill='%23999'>Фото</text></svg>">
        </div>
        <div class="about__text">
          <p><strong>Александра Халбаева</strong> — иллюстратор и дизайнер интерактивов. Здесь будет ваш текст: биография, подход к работе, список клиентов, награды и пр.</p>
          <p>Изображение слева занимает треть ширины экрана и может быть любой высоты. Справа — текст, занимающий оставшуюся ширину.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- =================== LIGHTBOX =================== -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lightbox__inner" id="lbInner">
      <button class="lb-close" id="lbClose" aria-label="Закрыть">×</button>
      <button class="lb-btn lb-prev" id="lbPrev" aria-label="Предыдущий">‹</button>
      <img class="lightbox__media" id="lbMedia" alt="Просмотр" />
      <button class="lb-btn lb-next" id="lbNext" aria-label="Следующий">›</button>
    </div>
  </div>

  <script>
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];

    /* =================== Навигация и аккордеон =================== */
    const sections = $$('.page');
    const navItems = $$('.nav__item');
    let currentPage = 'home';
    const backStack = [];
    const homeBack  = $('#homeBack');

    function jitterNavItem(el){
      const r = (min,max) => (Math.random()*(max-min)+min).toFixed(2);
      el.style.setProperty('--x1', '0%');  el.style.setProperty('--y1', r(0.5,3)+'%');
      el.style.setProperty('--x2', '100%'); el.style.setProperty('--y2', r(0.5,2.5)+'%');
      el.style.setProperty('--x3', '100%'); el.style.setProperty('--y3', r(96.5,99)+'%');
      el.style.setProperty('--x4', '0%');  el.style.setProperty('--y4', r(96.5,99)+'%');
    }

    function setPage(id){
      sections.forEach(s => s.classList.toggle('active', s.id===id));
      navItems.forEach(btn => btn.classList.toggle('active', btn.dataset.target===id));

      const isHome = (id === 'home');
      document.body.classList.toggle('is-home', isHome);

      // Схлопывание пунктов: на внутренних страницах схлопываем все, кроме активного
      navItems.forEach(btn => {
        if(isHome){ btn.classList.remove('collapsed'); }
        else { btn.classList.toggle('collapsed', btn.dataset.target !== id); }
      });

      // Обновляем подпись/ARIA для кнопки
      if(homeBack){ homeBack.setAttribute('aria-label', isHome ? ':>' : '>'); }

      // Обновляем hash
      if(location.hash.replace('#','') !== id){
        history.replaceState(null, '', '#'+id);
      }

      currentPage = id;
      // При возврате на главную — пересоздаём слой фигур
      if(isHome){ spawnShapes(true); }
    }

    // Инициализация навигации
    navItems.forEach(btn => {
      jitterNavItem(btn);
      btn.addEventListener('click', () => {
        const target = btn.dataset.target;
        if(currentPage && currentPage !== target){ backStack.push(currentPage); if(backStack.length>32) backStack.shift(); }
        setPage(target);
      });
    });
    if(homeBack){ jitterNavItem(homeBack); }

    // Горизонтальная прокрутка колесиком мыши
    $$('.gallery').forEach(gal => {
      gal.addEventListener('wheel', (e) => {
        if(Math.abs(e.deltaY) > Math.abs(e.deltaX)){
          e.preventDefault();
          gal.scrollLeft += e.deltaY;
        }
      }, { passive:false });
    });

    // Восстановление страницы по hash при загрузке
    window.addEventListener('DOMContentLoaded', () => {
      const target = (location.hash || '#home').replace('#','');
      setPage(['home','pictures','things','edtech','about'].includes(target) ? target : 'home');
      if(document.body.classList.contains('is-home')){ spawnShapes(true); }
      if(homeBack){
        homeBack.addEventListener('click', () => {
          const isHome = document.body.classList.contains('is-home');
          if(isHome){ fireworkFromButton(); }
          else { const prev = backStack.pop() || 'home'; setPage(prev); }
        });
      }
      // Лёгкое «оживление» кромок при загрузке
      navItems.forEach(jitterNavItem);
      if(homeBack) jitterNavItem(homeBack);

      // === ТЕСТЫ (в консоли) ===
      try {
        console.assert(document.querySelector('.nav'), 'Nav должен существовать');
        console.assert(document.querySelector('#shapes'), 'Слой фигур на главной должен существовать (#shapes)');
        setPage('pictures');
        console.assert(document.querySelector('#pictures.page.active'), 'Должна активироваться страница pictures');
        console.assert([...document.querySelectorAll('.nav__item')].some(b=>b.classList.contains('collapsed')), 'Другие пункты меню должны схлопываться');
        setPage('home');
        console.assert(document.body.classList.contains('is-home'), 'На главной должен быть класс is-home');
      } catch (e) { console.warn('Тесты UI упали:', e); }
    });

    // Обновлять «неровности» при ресайзе и перегенерировать фигуры на главной
    window.addEventListener('resize', () => {
      clearTimeout(window.__rsTO);
      window.__rsTO = setTimeout(()=>{
        navItems.forEach(jitterNavItem);
        if(document.body.classList.contains('is-home')) spawnShapes(true);
      }, 180);
    });

    /* =================== HOME: генерация плавающих фигур =================== */
    function spawnShapes(force=false){
      const layer = document.getElementById('shapes'); if(!layer) return;
      if(layer.children.length && !force) return;
      layer.innerHTML = '';
      const W = layer.clientWidth, H = layer.clientHeight;
      const count = 18;
      const pick = a => a[Math.floor(Math.random()*a.length)];
      for(let i=0;i<count;i++){
        const kind = pick(['square','circle','wave']);
        const dir  = pick(['LR','RL','TB','BT']);
        const el = document.createElement('div');
        if(kind==='wave'){
          el.className = 'wave';
          const segW = 24; const segH = Math.round(Math.random()*10)+14; const n = (Math.random()<0.5?4:6);
          el.style.setProperty('--segW', segW+'px');
          el.style.setProperty('--segH', segH+'px');
          el.style.width = (segW*n)+'px';
          el.style.height = segH+'px';
        } else {
          el.className = 'shape '+kind;
          const s = Math.max(10, Math.round((Math.random()*30+30)*0.7));
          el.style.width = s+'px'; el.style.height = s+'px';
          if(kind==='circle') el.style.borderRadius = '50%';
        }
        const dur = (Math.random()*14+14).toFixed(2)+'s';
        el.style.animationDuration = dur;
        el.style.animationTimingFunction = 'linear';
        el.style.animationIterationCount = 'infinite';
        const delaySec = -(i*1.111 + Math.random()*0.5);
        el.style.animationDelay = delaySec.toFixed(3)+'s';
        if(dir==='LR'){ const y=Math.random()*(H-40)+10; el.style.top=y+'px'; el.style.left='-25vw'; el.style.animationName='floatLR'; }
        else if(dir==='RL'){ const y=Math.random()*(H-40)+10; el.style.top=y+'px'; el.style.right='-25vw'; el.style.animationName='floatRL'; }
        else if(dir==='TB'){ const x=Math.random()*(W-60)+10; el.style.left=x+'px'; el.style.top='-25vh'; el.style.animationName='floatTB'; }
        else { const x=Math.random()*(W-60)+10; el.style.left=x+'px'; el.style.bottom='-25vh'; el.style.animationName='floatBT'; }
        layer.appendChild(el);
      }
    }

    /* =================== LIGHTBOX (открытие изображений) =================== */
    const lb = document.getElementById('lightbox');
    const lbMedia = document.getElementById('lbMedia');
    const lbPrev  = document.getElementById('lbPrev');
    const lbNext  = document.getElementById('lbNext');
    const lbClose = document.getElementById('lbClose');
    let currentGallery = null; let currentIndex = -1;

    function setLbMediaFromNode(node){
      const img = node.querySelector('img,video,svg');
      if(img && img.getAttribute('src')){
        lbMedia.setAttribute('src', img.getAttribute('src'));
        return;
      }
      // Заглушка, если в .media нет картинки
      const w = Math.max(400, Math.min(1200, node.clientWidth*3 || 600));
      const h = Math.max(300, Math.min(900,  node.clientHeight*3 || 450));
      const svg = encodeURIComponent(`<?xml version=\"1.0\" encoding=\"UTF-8\"?><svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}'><rect width='100%' height='100%' fill='%23dddddd'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='32' fill='%23999'>Превью</text></svg>`);
      lbMedia.setAttribute('src', `data:image/svg+xml;utf8,${svg}`);
    }

    function renderLightbox(){
      if(!currentGallery) return;
      const items = [...currentGallery.querySelectorAll('.media')];
      if(!items.length) return;
      if(currentIndex < 0) currentIndex = 0;
      if(currentIndex >= items.length) currentIndex = items.length - 1;
      setLbMediaFromNode(items[currentIndex]);
    }

    function openLightbox(gallery, index){
      currentGallery = gallery; currentIndex = index;
      renderLightbox();
      lb.classList.add('open');
      lb.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox(){
      lb.classList.remove('open');
      lb.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      currentGallery = null; currentIndex = -1;
      lbMedia.removeAttribute('src');
    }

    // Делегирование клика по плиткам .media внутри [data-gallery]
    document.addEventListener('click', (e) => {
      const media = e.target.closest('.media');
      if(!media) return;
      const gallery = media.closest('[data-gallery]');
      if(!gallery) return; // клики вне галерей игнорим
      const items = [...gallery.querySelectorAll('.media')];
      const index = items.indexOf(media);
      openLightbox(gallery, index);
    });

    // Управление лайтбоксом
    lbPrev && lbPrev.addEventListener('click', () => {
      if(!currentGallery) return;
      const items = [...currentGallery.querySelectorAll('.media')];
      currentIndex = (currentIndex - 1 + items.length) % items.length;
      renderLightbox();
    });
    lbNext && lbNext.addEventListener('click', () => {
      if(!currentGallery) return;
      const items = [...currentGallery.querySelectorAll('.media')];
      currentIndex = (currentIndex + 1) % items.length;
      renderLightbox();
    });
    lbClose && lbClose.addEventListener('click', closeLightbox);
    lb && lb.addEventListener('click', (e) => { if(e.target === lb) closeLightbox(); });
    window.addEventListener('keydown', (e) => {
      if(!lb.classList.contains('open')) return;
      if(e.key === 'Escape') closeLightbox();
      if(e.key === 'ArrowLeft') lbPrev.click();
      if(e.key === 'ArrowRight') lbNext.click();
    });

    // Мини‑тесты для лайтбокса (в консоли)
    try {
      const firstMedia = document.querySelector('[data-gallery] .media');
      console.assert(!!firstMedia, 'Должен быть хотя бы один .media в галерее');
    } catch(e){ console.warn('LB tests:', e); }

    /* =================== HOME BUTTON FIREWORK =================== */
    function fireworkFromButton(){
      const btn = homeBack; if(!btn) return;
      const rect = btn.getBoundingClientRect();
      const origin = { x: rect.left + rect.width/2, y: rect.top + rect.height/2 };
      const particles = 14;
      const types = ['square','circle','semi'];
      const frags = [];
      for(let i=0;i<particles;i++){
        const t = types[Math.floor(Math.random()*types.length)];
        const el = document.createElement('div');
        el.className = 'spark'+(t==='square'?'':(t==='circle'?' circle':' semi'));
        const s = Math.round(6 + Math.random()*8); // 6–14px, меньше основных фигур
        el.style.width = s+'px'; el.style.height = s+'px';
        el.style.position = 'fixed';
        el.style.zIndex = '200';
        document.body.appendChild(el);
        const ang = Math.random()*Math.PI*2;
        let vx = Math.cos(ang) * (220 + Math.random()*240); // px/s
        let vy = Math.sin(ang) * (220 + Math.random()*240);
        const ax = Math.cos(ang) * 900;   // ускорение наружу
        const ay = Math.sin(ang) * 900;
        const x0 = origin.x - s/2;
        const y0 = origin.y - s/2;
        frags.push({ el, x: x0, y: y0, vx, vy, ax, ay, life: 0 });
      }
      let last = performance.now();
      function tick(now){
        const dt = (now - last)/1000; last = now;
        let alive = 0;
        for(const f of frags){
          f.vx += f.ax * dt; f.vy += f.ay * dt;
          f.x  += f.vx * dt; f.y  += f.vy * dt;
          f.life += dt;
          const fade = Math.max(0, 1 - f.life/0.8);
          f.el.style.left = f.x + 'px';
          f.el.style.top  = f.y + 'px';
          f.el.style.opacity = String(fade);
          if(f.life < 0.8) alive++; else { f.el.remove(); }
        }
        if(alive) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }
  </script>
</body>
</html>
