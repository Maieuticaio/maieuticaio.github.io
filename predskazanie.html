<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Предсказание</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #ffffff;
      color: #111;
    }

    .btn-main {
      padding: 12px 26px;
      border-radius: 999px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      cursor: pointer;
      background: #111;
      color: #fff;
      transition: transform 0.12s ease, opacity 0.2s ease;
    }

    .btn-main:hover {
      transform: translateY(-1px);
    }

    .btn-main:active {
      transform: translateY(1px);
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    /* главный экран — кнопка строго по центру окна */
    #startScreen {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      z-index: 10;
    }

    #startScreen.active {
      display: flex;
    }

    /* экран с колодой: тоже полноэкранный центр */
    #readingScreen {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: #ffffff;
    }

    #readingScreen.active {
      display: flex;
    }

    .reading-center {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
    }

    /* обёртка с фиксированной высотой — её центр совпадает с центром экрана */
    .card-wrapper {
      position: relative;
      width: 320px;
      height: 340px;
    }

    .card-area {
      position: absolute;
      inset: 0;
    }

    .card {
      width: 280px;
      height: 280px;
      border-radius: 24px;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      user-select: none;
      transition: transform 0.24s ease-in-out, opacity 0.24s ease-in-out;
      overflow: hidden;
      will-change: transform, opacity;
    }

    /* внутренности карты для 3D-переворота */
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.55s ease;
      will-change: transform;
      z-index: 1; /* содержимое под затемнителем */
    }

    .card-face {
      position: absolute;
      inset: 0;
      border-radius: 24px;
      backface-visibility: hidden;
    }

    /* рубашка */
    .card-back {
      background-image: url("https://maieuticaio.github.io/folder/experiments/bgcards.png");
      background-size: cover;
      background-position: center;
    }

    /* лицевая сторона (пока просто серый квадрат с цифрой) */
    .card-front {
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      font-weight: 600;
      transform: rotateY(180deg);
    }

    .card-label {
      pointer-events: none;
    }

    /* при flipped показываем лицевую сторону */
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 2;           /* затемнение поверх содержимого */
      background: transparent;
    }

    /* три карты в стопке по высоте и затемнению */
    .card-pos-top {
      transform: translate(calc(-50% - 5px), calc(-50% - 5px));
      z-index: 3;
      opacity: 1;
    }

    .card-pos-middle {
      transform: translate(-50%, -50%);
      z-index: 2;
      opacity: 1;
    }

    .card-pos-bottom {
      transform: translate(calc(-50% + 5px), calc(-50% + 5px));
      z-index: 1;
      opacity: 0.95;
    }

    /* затемнение: теперь 15% и 20% */
    .card-pos-middle::after {
      background: rgba(0, 0, 0, 0.15);
    }

    .card-pos-bottom::after {
      background: rgba(0, 0, 0, 0.20);
    }

    /* верхняя карта уходит чуть влево-вверх и исчезает */
    .card-out {
      transform: translate(calc(-50% - 8px), calc(-50% - 8px));
      opacity: 0;
    }

    /* финальная карта — ближе к тексту (было -50px, стало -30px) */
    .card-final {
      transform: translate(calc(-50% - 5px), calc(-50% - 30px));
      z-index: 3;
      opacity: 1;
    }

    /* текст и кнопка — ближе к карте (подтянуто вверх) */
    .below {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-top: -4px;  /* ближе к карте */
      width: 100%;
      text-align: center;
    }

    #prediction {
      min-height: 3.5em;
      font-size: 1rem;
      line-height: 1.5;
      color: #222;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .restart {
      margin-top: 18px;
      font-size: 0.9rem;
      color: #333;
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 3px;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .restart:hover {
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <!-- главный экран: только кнопка, по центру -->
  <div id="startScreen" class="screen active">
    <button id="startButton" class="btn-main">Получить предсказание</button>
  </div>

  <!-- экран с колодой -->
  <div id="readingScreen" class="screen">
    <div class="reading-center">
      <div class="card-wrapper">
        <div class="card-area">
          <div class="card card-pos-top" id="cardTop">
            <div class="card-inner">
              <div class="card-face card-back"></div>
              <div class="card-face card-front">
                <span class="card-label">?</span>
              </div>
            </div>
          </div>
          <div class="card card-pos-middle" id="cardMid">
            <div class="card-inner">
              <div class="card-face card-back"></div>
              <div class="card-face card-front">
                <span class="card-label">?</span>
              </div>
            </div>
          </div>
          <div class="card card-pos-bottom" id="cardBottom">
            <div class="card-inner">
              <div class="card-face card-back"></div>
              <div class="card-face card-front">
                <span class="card-label">?</span>
              </div>
            </div>
          </div>
        </div>
        <div class="below">
          <div id="prediction"></div>
          <div id="restart" class="restart">Начать заново</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const totalCards = 32;

    const predictions = {
      1: "Ответ уже рядом — прислушайся к первому импульсу.",
      2: "Сейчас время подождать: ситуация ещё дозревает.",
      3: "Проси о помощи — другой человек станет ключом.",
      4: "Сделай один маленький шаг уже сегодня.",
      5: "Откажись от лишнего, и станет видно, куда идти.",
      6: "Информация придёт через письмо, сообщение или звонок.",
      7: "Сделай выбор сердцем, а потом перепроверь разумом.",
      8: "Смена плана пойдёт на пользу делу.",
      9: "Ситуация обернётся лучше, чем ты ожидаешь.",
      10: "Не торопи людей: каждый движется в своём ритме.",
      11: "Вопрос связан с усталостью — сначала восстанови силы.",
      12: "Сделка или договор окажутся выгодными.",
      13: "Отпусти прошлое, иначе оно потянет назад.",
      14: "Сейчас правильнее сказать «нет», даже если неловко.",
      15: "К тебе придёт неожиданная поддержка.",
      16: "Риск окупится, если ты заранее просчитаешь последствия.",
      17: "Сначала наведи порядок вокруг себя, потом принимай решения.",
      18: "Не всё ясно: спроси ещё один раз или уточни детали.",
      19: "Истинный ответ — в твоём теле: прислушайся к ощущениям.",
      20: "То, чего ты боишься, на деле меньше, чем кажется.",
      21: "Время учиться: новый навык изменит ход событий.",
      22: "Не бери на себя чужую ответственность.",
      23: "Пока не время для резких шагов — сделай разведку.",
      24: "Знак: ты идёшь в верном направлении, продолжай.",
      25: "В ближайшее время придётся сделать выбор в чью-то пользу.",
      26: "Смена окружения даст больше, чем попытки всё контролировать.",
      27: "Будь честна с собой: чего ты на самом деле хочешь?",
      28: "Не делись планами со всеми подряд — защити идею.",
      29: "Ответ «да», но путь к нему будет нелинейным.",
      30: "Ответ «нет», но позже появится другая возможность.",
      31: "Вселенная шутит: относись к ситуации проще.",
      32: "То, о чём ты спросила, важнее, чем кажется. Отнесись серьёзно."
    };

    const startScreen = document.getElementById("startScreen");
    const readingScreen = document.getElementById("readingScreen");
    const startButton = document.getElementById("startButton");

    const cardTop = document.getElementById("cardTop");
    const cardMid = document.getElementById("cardMid");
    const cardBottom = document.getElementById("cardBottom");

    const predictionEl = document.getElementById("prediction");
    const restartEl = document.getElementById("restart");

    let topEl = cardTop;
    let midEl = cardMid;
    let bottomEl = cardBottom;

    let deckIndex = 1;

    function setCardNumber(cardElement, num) {
      cardElement.dataset.num = num;
      const label = cardElement.querySelector(".card-label");
      if (label) label.textContent = num;
    }

    function nextNum() {
      const n = deckIndex;
      deckIndex++;
      if (deckIndex > totalCards) deckIndex = 1;
      return n;
    }

    function resetCardState(cardElement, positionClass) {
      cardElement.className = "card " + positionClass;
      cardElement.classList.remove("flipped");
    }

    function initStack() {
      deckIndex = 1 + Math.floor(Math.random() * totalCards);

      setCardNumber(cardTop, nextNum());
      setCardNumber(cardMid, nextNum());
      setCardNumber(cardBottom, nextNum());

      resetCardState(cardTop, "card-pos-top");
      resetCardState(cardMid, "card-pos-middle");
      resetCardState(cardBottom, "card-pos-bottom");

      topEl = cardTop;
      midEl = cardMid;
      bottomEl = cardBottom;

      topEl.style.opacity = "1";
      midEl.style.opacity = "1";
      bottomEl.style.opacity = "0.95";
    }

    startButton.addEventListener("click", () => {
      startScreen.classList.remove("active");
      readingScreen.classList.add("active");

      predictionEl.textContent = "";
      predictionEl.style.opacity = "0";
      restartEl.style.display = "none";
      restartEl.style.opacity = "0";

      initStack();
      startReading();
    });

    restartEl.addEventListener("click", () => {
      readingScreen.classList.remove("active");
      startScreen.classList.add("active");

      predictionEl.textContent = "";
      predictionEl.style.opacity = "0";
      restartEl.style.display = "none";
      restartEl.style.opacity = "0";
    });

    function startReading() {
      const targetNum = 1 + Math.floor(Math.random() * totalCards);
      // 7–12 шагов перетасовки
      const steps = 7 + Math.floor(Math.random() * 6);
      const stepDelay = 220;

      let stepIndex = 0;
      let isFinished = false;

      function doStep() {
        if (isFinished) return;

        const isLast = stepIndex === steps - 1;

        topEl.classList.add("card-out");

        setTimeout(() => {
          topEl.classList.remove("card-pos-top", "card-out", "card-final", "flipped");
          midEl.classList.remove("card-pos-middle");
          bottomEl.classList.remove("card-pos-bottom", "flipped");

          const oldTop = topEl;
          topEl = midEl;
          midEl = bottomEl;
          bottomEl = oldTop;

          topEl.classList.add("card-pos-top");
          midEl.classList.add("card-pos-middle");
          bottomEl.classList.add("card-pos-bottom");

          topEl.style.opacity = "1";
          midEl.style.opacity = "1";
          bottomEl.style.opacity = "0.95";

          if (isLast) {
            // финальная карта: номер станет виден после переворота
            setCardNumber(topEl, targetNum);

            midEl.style.opacity = "0";
            bottomEl.style.opacity = "0";

            // смещаем карту вверх (но ближе к тексту)
            setTimeout(() => {
              topEl.classList.remove("card-pos-top");
              topEl.classList.add("card-final");
            }, 40);

            // переворот карты
            setTimeout(() => {
              topEl.classList.add("flipped");
            }, 320);

            // после переворота — текст
            setTimeout(() => {
              predictionEl.textContent =
                predictions[targetNum] || "Эта карта пока молчит.";
              predictionEl.style.opacity = "1";

              // через секунду — кнопка "Начать заново"
              setTimeout(() => {
                restartEl.style.display = "block";
                requestAnimationFrame(() => {
                  restartEl.style.opacity = "1";
                });
              }, 1000);

              isFinished = true;
            }, 900);
          } else {
            // обычный шаг: обновляем нижнюю карту новым номером
            setCardNumber(bottomEl, nextNum());
            stepIndex++;
            setTimeout(doStep, stepDelay);
          }
        }, 200);
      }

      doStep();
    }
  </script>
</body>
</html>
